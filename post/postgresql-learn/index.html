<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Postgresql Learn - tipğŸŒ³tok( â€¢Ì€ Ï‰ â€¢Ì )y</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="tipğŸŒ³tok( â€¢Ì€ Ï‰ â€¢Ì )y" /><meta name="description" content="æ¦‚å¿µ sql DQL æŸ¥è¯¢ DML(Data manipulation Language) æ•°æ®æ“çºµè¯­è¨€ ï¼ˆinsert,update,deleteï¼‰ DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ ï¼Œå»ºè¡¨ï¼Œç´¢å¼•ï¼Œä¿®æ”¹ç­‰ é€»è¾‘ç»“æ„ è¡¨: Relation (Table) æ•°æ®è¡Œ: Tuple (Row)" /><meta name="keywords" content="tiptok, blog, learn" />






<meta name="generator" content="Hugo 0.68.3 with theme even" />


<link rel="canonical" href="https://tiptok.github.io/post/postgresql-learn/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.48bbaed5ffd1d8a7966595cb861fe2189773a3550abaa50f97eb0a01b75c8aba.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Postgresql Learn" />
<meta property="og:description" content="æ¦‚å¿µ sql DQL æŸ¥è¯¢ DML(Data manipulation Language) æ•°æ®æ“çºµè¯­è¨€ ï¼ˆinsert,update,deleteï¼‰ DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ ï¼Œå»ºè¡¨ï¼Œç´¢å¼•ï¼Œä¿®æ”¹ç­‰ é€»è¾‘ç»“æ„ è¡¨: Relation (Table) æ•°æ®è¡Œ: Tuple (Row)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tiptok.github.io/post/postgresql-learn/" />
<meta property="article:published_time" content="2021-06-21T15:04:51+00:00" />
<meta property="article:modified_time" content="2021-06-21T15:04:51+00:00" />
<meta itemprop="name" content="Postgresql Learn">
<meta itemprop="description" content="æ¦‚å¿µ sql DQL æŸ¥è¯¢ DML(Data manipulation Language) æ•°æ®æ“çºµè¯­è¨€ ï¼ˆinsert,update,deleteï¼‰ DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ ï¼Œå»ºè¡¨ï¼Œç´¢å¼•ï¼Œä¿®æ”¹ç­‰ é€»è¾‘ç»“æ„ è¡¨: Relation (Table) æ•°æ®è¡Œ: Tuple (Row)">
<meta itemprop="datePublished" content="2021-06-21T15:04:51&#43;00:00" />
<meta itemprop="dateModified" content="2021-06-21T15:04:51&#43;00:00" />
<meta itemprop="wordCount" content="5509">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Postgresql Learn"/>
<meta name="twitter:description" content="æ¦‚å¿µ sql DQL æŸ¥è¯¢ DML(Data manipulation Language) æ•°æ®æ“çºµè¯­è¨€ ï¼ˆinsert,update,deleteï¼‰ DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ ï¼Œå»ºè¡¨ï¼Œç´¢å¼•ï¼Œä¿®æ”¹ç­‰ é€»è¾‘ç»“æ„ è¡¨: Relation (Table) æ•°æ®è¡Œ: Tuple (Row)"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">ğŸŒ³TIPTOK</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">â°é¦–é¡µ</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">â±å½’æ¡£</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">â²æ ‡ç­¾</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">âŒšåˆ†ç±»</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">ğŸŒ³TIPTOK</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">â°é¦–é¡µ</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">â±å½’æ¡£</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">â²æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">âŒšåˆ†ç±»</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Postgresql Learn</h1>

      <div class="post-meta">
        <span class="post-time"> 2021-06-21 </span>
        
          <span class="more-meta"> çº¦ 5509 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 11 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#æ¦‚å¿µ">æ¦‚å¿µ</a>
          <ul>
            <li><a href="#sql">sql</a></li>
            <li><a href="#é€»è¾‘ç»“æ„">é€»è¾‘ç»“æ„</a></li>
          </ul>
        </li>
        <li><a href="#å¸¸ç”¨åˆ†æ">å¸¸ç”¨åˆ†æ</a></li>
        <li><a href="#æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</a>
          <ul>
            <li><a href="#1-å¸¸è§„ç±»å‹">1. å¸¸è§„ç±»å‹</a></li>
            <li><a href="#2-æ—¶é—´ç±»å‹">2. æ—¶é—´ç±»å‹</a></li>
            <li><a href="#3-ç½‘ç»œ">3. ç½‘ç»œ</a></li>
            <li><a href="#4-æ–‡æ¡£-å…¨æ–‡æœç´¢">4. æ–‡æ¡£-å…¨æ–‡æœç´¢</a></li>
          </ul>
        </li>
        <li><a href="#æ•°æ®åº“ç»“æ„">æ•°æ®åº“ç»“æ„</a>
          <ul>
            <li><a href="#è¡¨">è¡¨</a></li>
          </ul>
        </li>
        <li><a href="#ç´¢å¼•">ç´¢å¼•</a>
          <ul>
            <li><a href="#å¸¸ç”¨ç´¢å¼•">å¸¸ç”¨ç´¢å¼•</a></li>
            <li><a href="#æ–°å»ºç´¢å¼•">æ–°å»ºç´¢å¼•</a></li>
          </ul>
        </li>
        <li><a href="#é”">é”</a>
          <ul>
            <li><a href="#acid">ACID</a></li>
            <li><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</a></li>
            <li><a href="#æ­»é”">æ­»é”</a></li>
            <li><a href="#è¡Œçº§é”">è¡Œçº§é”</a></li>
            <li><a href="#è¡¨çº§é”">è¡¨çº§é”</a></li>
            <li><a href="#äºŒé˜¶æ®µæäº¤">äºŒé˜¶æ®µæäº¤</a></li>
          </ul>
        </li>
        <li><a href="#å†…å¹•">å†…å¹•</a>
          <ul>
            <li><a href="#æ‰§è¡Œè®¡åˆ’">æ‰§è¡Œè®¡åˆ’</a></li>
            <li><a href="#ç»Ÿè®¡ä¿¡æ¯">ç»Ÿè®¡ä¿¡æ¯</a></li>
            <li><a href="#åºå·">åºå·</a></li>
            <li><a href="#æœåŠ¡ç®¡ç†">æœåŠ¡ç®¡ç†</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2>
<h3 id="sql">sql</h3>
<ul>
<li>DQL  æŸ¥è¯¢</li>
<li>DML(Data manipulation Language) æ•°æ®æ“çºµè¯­è¨€ ï¼ˆinsert,update,deleteï¼‰</li>
<li>DDL(Data Definition Language) æ•°æ®å®šä¹‰è¯­è¨€ ï¼Œå»ºè¡¨ï¼Œç´¢å¼•ï¼Œä¿®æ”¹ç­‰</li>
</ul>
<h3 id="é€»è¾‘ç»“æ„">é€»è¾‘ç»“æ„</h3>
<ul>
<li>è¡¨: Relation (Table)</li>
<li>æ•°æ®è¡Œ: Tuple (Row)</li>
</ul>
<h2 id="å¸¸ç”¨åˆ†æ">å¸¸ç”¨åˆ†æ</h2>
<ul>
<li>æŸ¥è¯¢ç´¢å¼•å¤§å° select pg_indexes_size(&lsquo;table1&rsquo;);</li>
<li>è¡¨å¤§å° select pg_relation_size(&lsquo;track_20210501&rsquo;);</li>
<li>è¡¨é”çŠ¶æ€ select * from pg_locks;</li>
<li>æ‰§è¡Œè®¡åˆ’ EXPLAIN ANALYZE VERBOSE select &hellip;</li>
<li>æŸ¥è¯¢è¿æ¥ä¼šè¯ï¼ˆæœåŠ¡è¿›ç¨‹ï¼‰SELECT * FROM pg_stat_activity</li>
</ul>
<h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2>
<h3 id="1-å¸¸è§„ç±»å‹">1. å¸¸è§„ç±»å‹</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">demo_common</span><span class="p">(</span>
	<span class="n">int_</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> 
	<span class="cm">/*æœ‰é•¿åº¦é™åˆ¶,æœ€å¤šnä¸ªå­—ç¬¦,text å˜é•¿æ— é•¿åº¦é™åˆ¶*/</span>
	<span class="n">varchar_</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> 
	<span class="n">text_</span> <span class="nb">text</span><span class="p">,</span>
	<span class="cm">/*60.8888ï¼Œé«˜ç²¾åº¦è®¡ç®—ï¼ˆeg:è´§å¸é‡‘é¢ï¼‰ï¼Œé€Ÿåº¦å¸decimalæ…¢ï¼Œç²¾åº¦å…è®¸çš„æœ€å¤§å€¼ä¸º1000*/</span>
	<span class="n">numeric_</span> <span class="nb">numeric</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> 
	<span class="n">decimal_</span> <span class="nb">decimal</span><span class="p">,</span>
	<span class="cm">/*
</span><span class="cm">	è‡ªå¢æ•´æ•° smallserial,serialå’Œbigserialä¸æ˜¯çœŸæ­£çš„ç±»å‹ï¼Œä»…æ ‡è¯†ä½œç”¨ï¼Œç›¸å½“äºAUTO_INCREMENT å±æ€§
</span><span class="cm">	*/</span>
	<span class="n">serial_</span>  <span class="nb">serial</span><span class="p">,</span>
	<span class="cm">/*
</span><span class="cm">	moneyå€¼å¯ä»¥è¢«è½¬æ¢ä¸ºnumericè€Œä¸ä¸¢å¤±ç²¾åº¦ã€‚ è½¬æ¢ä¸ºå…¶ä»–ç±»å‹å¯èƒ½ä¸¢å¤±ç²¾åº¦
</span><span class="cm">	*/</span>
	<span class="n">money_</span> <span class="n">money</span><span class="p">,</span>
	<span class="cm">/*å­˜å‚¨äºŒè¿›åˆ¶ä¸²*/</span>
	<span class="n">bytea_</span> <span class="n">bytea</span><span class="p">,</span>

	<span class="n">boolean_</span> <span class="nb">boolean</span><span class="p">,</span> <span class="cm">/*çœŸï¼štrue yes on 1 / å‡ï¼šfalse no off 0*/</span>

	<span class="n">bit_</span> <span class="nb">bit</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="cm">/*ä½ä¸² ä¸€ä¸ªä½ä¸²å€¼å¯¹äºæ¯8ä½çš„ç»„éœ€è¦ä¸€ä¸ªå­—èŠ‚ */</span>

	<span class="n">uuid_</span> <span class="n">uuid</span><span class="p">,</span> <span class="cm">/*uuid a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11 (æ ¸å¿ƒæ•°æ®åº“ä¸åŒ…å«ä»»ä½•ç”¨äºäº§ç”ŸUUIDçš„å‡½æ•°)*/</span>

	<span class="n">json_</span> <span class="n">json</span><span class="p">,</span>

	<span class="n">jsonb_</span> <span class="n">jsonb</span><span class="p">,</span><span class="cm">/*jsonb json è¾“å…¥æ ¼å¼ä¸€ç›´ï¼ŒåŒºåˆ«jsonbè¾“å…¥ä¼šæ…¢ä¸€ç‚¹ï¼Œå¤„ç†é€Ÿåº¦æ¯”jsonå¿«ï¼Œä¸éœ€è¦è§£æï¼ˆè¾“å…¥çš„æ—¶å€™æå‰åšå¥½ï¼‰,jsonbåˆ—ç›´æ¥æ”¯æŒç´¢å¼•ï¼ˆjsonåªèƒ½é€šè¿‡å»ºå‡½æ•°ç´¢å¼•ï¼‰ï¼Œåœ¨jsonbä¸Šé¢å»ºginç´¢å¼•æ¯”btreeå¥½*/</span>

	<span class="n">array_</span> <span class="n">int2</span><span class="p">[]</span> <span class="cm">/*text[]  text[][]*/</span>
<span class="p">);</span>


<span class="k">drop</span> <span class="k">table</span> <span class="n">demo_common</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">demo_common</span>

<span class="cm">/*money*/</span>
<span class="k">SELECT</span> <span class="s1">&#39;12.34&#39;</span><span class="p">::</span><span class="n">float8</span><span class="p">::</span><span class="nb">numeric</span><span class="p">::</span><span class="n">money</span><span class="p">;</span>
<span class="k">SELECT</span> <span class="s1">&#39;52093.89&#39;</span><span class="p">::</span><span class="n">money</span><span class="p">::</span><span class="nb">numeric</span><span class="p">::</span><span class="n">float8</span><span class="p">;</span>

<span class="k">SELECT</span> <span class="k">NULL</span><span class="p">::</span><span class="nb">boolean</span>


<span class="k">SELECT</span> <span class="n">E</span><span class="s1">&#39;\\xDEADBEEF&#39;</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">demo_common</span> 
<span class="p">(</span><span class="n">int_</span><span class="p">,</span> <span class="n">varchar_</span> <span class="p">,</span><span class="n">text_</span> <span class="p">,</span> <span class="n">numeric_</span><span class="p">,</span> <span class="n">decimal_</span><span class="p">,</span> <span class="n">money_</span><span class="p">,</span>  <span class="n">bytea_</span> <span class="p">,</span><span class="n">boolean_</span> <span class="p">,</span><span class="n">bit_</span>       <span class="p">,</span><span class="n">uuid_</span><span class="p">,</span>
<span class="n">json_</span><span class="p">,</span>
<span class="n">jsonb_</span><span class="p">,</span>
<span class="n">array_</span>
<span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="mi">2000</span><span class="p">,</span><span class="s1">&#39;varchar&#39;</span> <span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="s1">&#39;60.8888&#39;</span><span class="p">,</span><span class="s1">&#39;88.6666&#39;</span><span class="p">,</span><span class="s1">&#39;ï¿¥12.34&#39;</span><span class="p">,</span><span class="s1">&#39;\\x10&#39;</span><span class="p">,</span><span class="k">true</span>     <span class="p">,</span><span class="n">B</span><span class="s1">&#39;01000000&#39;</span><span class="p">,</span><span class="s1">&#39;a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11&#39;</span><span class="p">,</span>
<span class="s1">&#39;{&#34;bar&#34;: &#34;baz&#34;, &#34;balance&#34;: 7.77, &#34;active&#34;:false}&#39;</span><span class="p">,</span>
<span class="s1">&#39;{&#34;bar&#34;: &#34;baz&#34;, &#34;balance&#34;: 7.77, &#34;active&#34;:false}&#39;</span><span class="p">,</span>
<span class="s1">&#39;{1,2,3,4}&#39;</span>  <span class="cm">/*ARRAY[1, 2, 3, 4]*/</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>jsonç±»å‹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">select jsonb &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39; col1,&#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39;::jsonb col2

/*jsonæ“ä½œç¬¦*/
/*1. -&gt; å–å‡ºjsonæ•°ç»„ä¸€ä¸ªå¯¹è±¡*/
select &#39;[1,2,3]&#39;::json-&gt; 1  /*è¾“å‡º 2 */
/*2. -&gt; é€šè¿‡keyå–å‡ºjsonä¸€ä¸ªå­å¯¹è±¡*/
select &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39;::json-&gt;&#39;a&#39; /*è¾“å‡º 1 */
/*äºä¸Šé¢ä¸€è‡´ï¼Œä½†è¿”å›å€¼æ˜¯ä¸€ä¸ªtextç±»å‹*/
select &#39;[1,2,3]&#39;::json-&gt;&gt;1
select &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39;::json-&gt;&gt;&#39;a&#39; 
/*3. #&gt; é€šè¿‡æŒ‡å®šè·¯å¾„å–å‡ºjsonä¸­ä¸€ä¸ªå¯¹è±¡*/
select &#39;{&#34;a&#34;:{&#34;b&#34;:{&#34;c&#34;:1}}}&#39;::json#&gt;&#39;{a,b}&#39; /*è¾“å‡º {&#34;c&#34;:1} */
select &#39;{&#34;a&#34;:{&#34;b&#34;:{&#34;c&#34;:1}}}&#39;::json#&gt;&#39;{a,b,c}&#39; /*è¾“å‡º 1 */
select &#39;{&#34;a&#34;:{&#34;b&#34;:{&#34;c&#34;:1}}}&#39;::json#&gt;&gt;&#39;{a,b,c}&#39; /*è¾“å‡º 1 (åŒºåˆ«è¿”å›å€¼æ˜¯ä¸€ä¸ªtextç±»å‹)*/


/*jsonbå€¼æ¯”è¾ƒ*/
/*
1. ä¸¤ä¸ªjsonå¯¹è±¡æ˜¯å¦ç›¸åŒ
*/
select jsonb &#39;[1,2]&#39; = jsonb &#39;[1,2]&#39;   /* è¾“å‡º t*/
select jsonb &#39;[1,2]&#39; = jsonb &#39;[2,1]&#39;   /* è¾“å‡º f*/
/*
2. @&gt; å·¦è¾¹å¯¹è±¡æ˜¯å¦åŒ…å«å³è¾¹å¯¹è±¡
*/
select jsonb &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39; @&gt; jsonb &#39;{&#34;b&#34;:2}&#39;   /* è¾“å‡º t*/
select jsonb &#39;[1,2]&#39; @&gt; jsonb &#39;[2]&#39;  /* è¾“å‡º t*/
/*
3. ? æŒ‡å®šçš„å­—ç¬¦ä¸²æ˜¯å¦å­˜åœ¨äºjsonå¯¹è±¡
*/ 
select jsonb &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39; ? &#39;b&#39;  /* è¾“å‡º t*/
/*
4. ?| å³å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ˜¯å¦ä»»æ„ä¸€ä¸ªå…ƒç´ å­˜åœ¨äºjsonå¯¹è±¡ (jsonä¸­çš„å…ƒç´ éœ€è¦å¼å­—ç¬¦ä¸²ç±»å‹)
*/ 
select jsonb &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39; ?| array[&#39;b&#39;,&#39;c&#39;] /* è¾“å‡º t*/
select jsonb &#39;[&#34;1&#34;,&#34;2&#34;]&#39; ?| array [&#39;2&#39;,&#39;3&#39;] /* è¾“å‡º t*/
select jsonb &#39;[1,2]&#39; ?| array [&#39;2&#39;,&#39;3&#39;] /* è¾“å‡º f*/
/*
5. ?&amp; å³å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€æœ‰å…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨äºjsonå¯¹è±¡ (jsonä¸­çš„å…ƒç´ éœ€è¦å¼å­—ç¬¦ä¸²ç±»å‹)
*/
select jsonb &#39;{&#34;a&#34;:1,&#34;b&#34;:2}&#39; ?&amp; array[&#39;b&#39;,&#39;c&#39;] /* è¾“å‡º f*/
select jsonb &#39;[&#34;1&#34;,&#34;2&#34;]&#39; ?&amp; array [&#39;1&#39;,&#39;2&#39;] /* è¾“å‡º t*/
select jsonb &#39;[1,2]&#39; ?&amp; array [&#39;2&#39;,&#39;3&#39;] /* è¾“å‡º f*/

</code></pre></td></tr></table>
</div>
</div><h3 id="2-æ—¶é—´ç±»å‹">2. æ—¶é—´ç±»å‹</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*å•ä½è§£æåº¦ 1å¾®å¦™ é™¤date(æ—¥)*/
create table demo_time(
	sn    serial,
	date_ date, /*æ—¥æœŸ æ¨èæ ¼å¼:1999-01-08*/
	timestamp_ TIMESTAMP default now(),/*åŒ…æ‹¬æ—¥æœŸå’Œæ—¶é—´ï¼ˆæ— æ—¶åŒºï¼‰*/
	timestamptz_ timestamptz default CURRENT_TIMESTAMP,/*åŒ…æ‹¬æ—¥æœŸå’Œæ—¶é—´ï¼ˆæœ‰æ—¶åŒºï¼‰*/
	time_ time, /*ä¸€å¤©ä¸­çš„æ—¶é—´ 00:00:00 - 24:00:00*/
	timetz_ timetz, /*ä¸€å¤©ä¸­çš„æ—¶é—´(å¸¦æ—¶åŒº) 00:00:00+0800 - 24:00:00-0800*/
	interval_ interval  /*æ—¶é—´é—´éš” 1 12:59:10ï¼ˆ1 day 12 hours 59 min 10 secï¼‰*/
)

DROP TABLE demo_time 
SELECT * FROM demo_time

INSERT INTO demo_time
(date_ ,       timestamp_ ,            timestamptz_,               time_,         timetz_,       interval_)
VALUES
(&#39;1999-01-08&#39;,&#39;2021-05-12 09:59:31.36&#39;,&#39;2021-05-12 09:59:31.36+08&#39;,&#39;20:00:00.22&#39;,&#39;12:00:00.22+08&#39;,&#39;1 12:59:10&#39;)

SELECT CURRENT_TIMESTAMP
</code></pre></td></tr></table>
</div>
</div><h3 id="3-ç½‘ç»œ">3. ç½‘ç»œ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">create table demo_net(
    sn serial,
    cidr_ cidr, /*äº’è”ç½‘åŸŸè·¯ç”±ï¼ˆClassless Internet Domain Routingï¼‰ ä¿å­˜ä¸€ä¸ª IPv4 æˆ– IPv6 ç½‘ç»œåœ°å€å£°æ˜*/
    inet_ inet,/*inetå’Œcidrç±»å‹ä¹‹é—´çš„æœ¬è´¨åŒºåˆ«æ˜¯inetæ¥å—å³è¾¹æœ‰éé›¶ä½çš„ç½‘ç»œæ©ç ï¼Œ è€Œcidrä¸æ¥å— 192.168.0.1/24  (192.168.0.1 AND 255.255.255.0 = 0.0.0.1)*/
    macaddr_ macaddr,/*mac 6å­—èŠ‚ï¼ˆ16è¿›åˆ¶ï¼‰*/
    macaddr8_ macaddr8/*mac 8å­—èŠ‚ï¼ˆ16è¿›åˆ¶ï¼‰ ä»macaddr6 è½¬ åˆ°macaddr8(ç¬¬4å’Œç¬¬5å­—èŠ‚åˆ†åˆ«è®¾ç½®ä¸ºFFå’ŒFE)*/
)

DROP TABLE demo_net 
SELECT * FROM demo_net

INSERT INTO demo_net
(cidr_,               inet_ ,           macaddr_ ,           macaddr8_ )
VALUES
(&#39;192.168.100.128/25&#39;,&#39;192.168.0.1/24&#39;,&#39;E0-D5-5E-6F-A4-88&#39;,&#39;E2:D5:5E:FF:FE:6F:A4:88&#39;)
/*&#39;E0-D5-5E-6F-A4-88&#39; == &#39;E2:D5:5E:FF:FE:6F:A4:88&#39;*/
SELECT macaddr8_set7bit(&#39;E0-D5-5E-6F-A4-88&#39;);  /* è¾“å‡º e2:d5:5e:ff:fe:6f:a4:88 */
</code></pre></td></tr></table>
</div>
</div><h3 id="4-æ–‡æ¡£-å…¨æ–‡æœç´¢">4. æ–‡æ¡£-å…¨æ–‡æœç´¢</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*å…¨æ–‡æœç´¢*/
create table demo_text(
	sn serial,
	title  text,
	tsvector_ tsvector  /*tsvectorç±»å‹è¡¨ç¤ºä¸€ä¸ªä¸ºæ–‡æœ¬æœç´¢ä¼˜åŒ–çš„å½¢å¼ä¸‹çš„æ–‡æ¡£ï¼Œtsqueryç±»å‹è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬æŸ¥è¯¢*/
)
DROP TABLE demo_text 
SELECT * FROM demo_text

INSERT INTO  demo_text
(title,tsvector_ )
VALUES
(&#39;a fat cat&#39;,&#39;a fat cat sat on a mat and ate a fat rat&#39;)
/*
å…¨æ–‡æœç´¢æ˜¯åŸºäºåŒ¹é…æ“ä½œç¬¦@@å®ç°
*/
select * from demo_text where tsvector_ @@ to_tsquery(&#39;cat | mouse&#39;) /* true */

select * from demo_text where tsvector_ @@ to_tsquery(&#39;cat &amp; mouse&#39;) /* false */

select * from demo_text where tsvector_ @@ to_tsquery(&#39;english&#39;, &#39;cat | cat&#39;)/* true */

select title || &#39; # &#39; || tsvector_ as Document FROM demo_text

SELECT &#39;a fat cat sat on a mat and ate a fat rat&#39;::tsvector @@ &#39;cat &amp; rat&#39;::tsquery;
</code></pre></td></tr></table>
</div>
</div><h2 id="æ•°æ®åº“ç»“æ„">æ•°æ®åº“ç»“æ„</h2>
<h3 id="è¡¨">è¡¨</h3>
<ol>
<li>ç»§æ‰¿è¡¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="cm">/*
</span><span class="cm">è¡¨ç»§æ‰¿
</span><span class="cm">1.alter table ä¿®æ”¹çˆ¶è¡¨ç»“æ„ï¼Œä¹Ÿä¼šåŒæ—¶ä¿®æ”¹å­è¡¨ç»“æ„ï¼ˆå”¯ä¸€çº¦æŸã€å¤–é”®çš„ä½¿ç”¨ä¸ä¼šæ‰©å¤§åˆ°å­è¡¨ï¼‰
</span><span class="cm">2.INHERITSæœ¬èº«æ°¸è¿œä¸ä¼šç»§æ‰¿ç´¢å¼•ã€‚å®ƒåªä¼šç»§æ‰¿åˆ—
</span><span class="cm">*/</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">demo_inherits_parent</span> <span class="p">(</span>
	<span class="n">id</span> <span class="n">int4</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
	<span class="n">col1</span> <span class="nb">text</span><span class="p">,</span>
	<span class="n">col2</span> <span class="nb">boolean</span>
<span class="p">);</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">demo_inherits_child</span><span class="p">(</span>
	<span class="n">col3</span> <span class="nb">int</span>
<span class="p">)</span><span class="k">INHERITS</span><span class="p">(</span><span class="n">demo_inherits_parent</span><span class="p">);</span>

<span class="cm">/*1.åœ¨ç»§æ‰¿è¡¨ï¼ˆdemo_inherits_childï¼‰ä¸Šé¢æ’å…¥ï¼Œä»çˆ¶è¡¨ï¼ˆdemo_inherits_parentï¼‰å¯ä»¥æŸ¥åˆ°ï¼Œä»çˆ¶è¡¨ä¸Šé¢æ’å…¥ï¼Œç»§æ‰¿è¡¨ä¸Šé¢æŸ¥ä¸åˆ°*/</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">demo_inherits_parent</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">demo_inherits_child</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">demo_inherits_child</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;item1&#39;</span><span class="p">,</span><span class="k">false</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">demo_inherits_parent</span> <span class="k">VALUES</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;item2&#39;</span><span class="p">,</span><span class="k">false</span><span class="p">);</span>
<span class="k">update</span> <span class="n">demo_inherits_child</span> <span class="k">set</span> <span class="n">col3</span><span class="o">=</span><span class="mi">100</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">1</span> 
<span class="k">update</span> <span class="n">demo_inherits_parent</span> <span class="k">set</span> <span class="n">col2</span><span class="o">=</span><span class="k">true</span> <span class="k">where</span> <span class="n">id</span> <span class="o">=</span><span class="mi">1</span> 

<span class="cm">/*å¦‚æœåªæƒ³æŸ¥è¯¢çˆ¶è¡¨è®°å½•ï¼ŒæŸ¥è¯¢åŠ  only å…³é”®å­—*/</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">only</span> <span class="n">demo_inherits_parent</span>
</code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>åˆ†åŒºè¡¨</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*
åˆ†åŒºè¡¨
- é€šè¿‡è¡¨ç»§æ‰¿å®ç°åˆ†åŒºè¡¨ ï¼ˆä¸€èˆ¬çˆ¶è¡¨ä¸å­˜æ•°æ®ï¼Œåªå­˜åœ¨å­è¡¨ä¸­ï¼‰
- åˆ é™¤åˆ†åŒºæ•°æ®å¿«
- æŸ¥è¯¢æˆ–æ›´æ–°åˆ†åŒºè®°å½•å¿«
- 
*/
create table track(
	simnum text,  
	lon    decimal,
	lat    decimal,
	/*track_date date not null,*/
	track_time timestamp not null,
	alarm_status int8
);
create table track_20210501 (CHECK (track_time &gt;= DATE &#39;2021-05-1&#39; AND track_time &lt; DATE &#39;2021-05-2&#39;))INHERITS(track);
create table track_20210502 (CHECK (track_time &gt;= DATE &#39;2021-05-2&#39; AND track_time &lt; DATE &#39;2021-05-3&#39;))INHERITS(track);
create table track_20210503 (CHECK (track_time &gt;= DATE &#39;2021-05-3&#39; AND track_time &lt; DATE &#39;2021-05-4&#39;))INHERITS(track);
create table track_20210504 (CHECK (track_time &gt;= DATE &#39;2021-05-4&#39; AND track_time &lt; DATE &#39;2021-05-5&#39;))INHERITS(track);
create table track_20210505 (CHECK (track_time &gt;= DATE &#39;2021-05-5&#39; AND track_time &lt; DATE &#39;2021-05-6&#39;))INHERITS(track);

/*å•ç‹¬åœ¨åˆ†åŒºè¡¨ä¸Šé¢å»ºç«‹ç´¢å¼•*/
create INDEX idx_track_20210501_track_time on  track_20210501 (simnum,track_time)

drop table track,track_20210501,track_20210502,track_20210503,track_20210504,track_20210505

INSERT INTO track_20210501 VALUES(&#39;18860183050&#39;,116.46,39.92,&#39;2021-05-01 11:50:00&#39;,0);
INSERT INTO track_20210502 VALUES(&#39;18860183050&#39;,116.46,39.92,&#39;2021-05-02 10:50:00&#39;,0);
SELECT * from track
SELECT * from track_20210501

/*æŸ¥çœ‹æ‰«æåˆ†åŒºæƒ…å†µ*/
EXPLAIN SELECT * from track where track_time &gt;&#39;2021-05-1&#39; and track_time &lt;&#39;2021-05-2&#39;
/*å¦‚æœè¦æ‰«ææ¯å¼ åˆ†åŒºå­è¡¨ï¼Œè¦æŠŠconstraint_exclusion = &#39;off&#39;*/
set constraint_exclusion=&#39;on&#39;;
EXPLAIN SELECT * from track where track_time &gt;&#39;2021-05-1&#39; and track_time &lt;&#39;2021-05-2&#39;;

/*
åœ¨çˆ¶è¡¨ä¸Šé¢æ’å…¥æ•°æ®æ˜ å°„åˆ°å­è¡¨
1. ç›´æ¥insert å¯¹åº” æ—¥æœŸçš„å­è¡¨
2. åŸºäºè§¦å‘å™¨
3. åŸºäº postgresql RULE  è§„åˆ™ :
- ç›¸æ¯”è§¦å‘å™¨ï¼Œæœ‰æ›´æ˜¾è‘—å¼€é”€ï¼Œæ¯æ¬¡æ’å…¥æ£€æŸ¥éƒ½æœ‰ä¸€æ¬¡å¼€é”€ï¼Œé€‚åˆæ‰¹é‡æ’å…¥çš„æƒ…å†µï¼Œå…¶ä»–æ›´å¤šæ—¶å€™åŸºäºè§¦å‘å™¨æ›´å¥½
- COPYæ’å…¥ä¸ä¼šè§¦å‘è§„åˆ™ï¼Œè§¦å‘å™¨å´å¯ä»¥
- å¦‚æœæ’å…¥æ•°æ®åœ¨è§„åˆ™ä¹‹å¤–ï¼Œæ•°æ®ä¼šæ’å…¥åˆ°ä¸»è¡¨è€Œä¸ä¼šæŠ¥é”™
*/
/*åŸºäº postgresql RULE*/
CREATE RULE track_20210501 AS ON INSERT TO track WHERE (track_time &gt;= DATE &#39;2021-05-1&#39; AND track_time &lt; DATE &#39;2021-05-2&#39;)
DO INSTEAD INSERT INTO track_20210501 VALUES(NEW.*);
CREATE RULE track_20210502 AS ON INSERT TO track WHERE (track_time &gt;= DATE &#39;2021-05-2&#39; AND track_time &lt; DATE &#39;2021-05-3&#39;)
DO INSTEAD INSERT INTO track_20210502 VALUES(NEW.*);
CREATE RULE track_20210503 AS ON INSERT TO track WHERE (track_time &gt;= DATE &#39;2021-05-3&#39; AND track_time &lt; DATE &#39;2021-05-4&#39;)
DO INSTEAD INSERT INTO track_20210503 VALUES(NEW.*);
CREATE RULE track_20210504 AS ON INSERT TO track WHERE (track_time &gt;= DATE &#39;2021-05-4&#39; AND track_time &lt; DATE &#39;2021-05-5&#39;)
DO INSTEAD INSERT INTO track_20210504 VALUES(NEW.*);
CREATE RULE track_20210505 AS ON INSERT TO track WHERE (track_time &gt;= DATE &#39;2021-05-5&#39; AND track_time &lt; DATE &#39;2021-05-6&#39;)
DO INSTEAD INSERT INTO track_20210505 VALUES(NEW.*);

INSERT INTO track VALUES(&#39;18860183050&#39;,116.46,39.92,&#39;2021-05-04 11:50:00&#39;,0);
SELECT * from track_20210504

/*åŸºäºè§¦å‘å™¨*/
CREATE OR REPLACE FUNCTION track_insert_trigger()
RETURNS TRIGGER AS $$
BEGIN
	IF (NEW.track_time &gt;= DATE &#39;2021-05-1&#39; AND NEW.track_time &lt; DATE &#39;2021-05-2&#39; )
	THEN INSERT INTO track_20210501 VALUES(NEW.*);
	ELSEIF (NEW.track_time &gt;= DATE &#39;2021-05-2&#39; AND NEW.track_time &lt; DATE &#39;2021-05-3&#39; )
	THEN INSERT INTO track_20210501 VALUES(NEW.*);
	ELSEIF (NEW.track_time &gt;= DATE &#39;2021-05-3&#39; AND NEW.track_time &lt; DATE &#39;2021-05-4&#39; )
	THEN INSERT INTO track_20210501 VALUES(NEW.*);
	ELSEIF (NEW.track_time &gt;= DATE &#39;2021-05-4&#39; AND NEW.track_time &lt; DATE &#39;2021-05-5&#39; )
	THEN INSERT INTO track_20210501 VALUES(NEW.*);
	ELSEIF (NEW.track_time &gt;= DATE &#39;2021-05-5&#39; AND NEW.track_time &lt; DATE &#39;2021-05-6&#39; )
	THEN INSERT INTO track_20210501 VALUES(NEW.*);
	ELSE
	RAISE EXCEPTION &#39;Date out of range . Fix the track_insert_trigger() function!&#39;;
	END IF;
	RETURN NULL;
END;
$$ 
LANGUAGE plpgsql;

CREATE TRIGGER track_insert_trigger 
BEFORE INSERT ON track 
FOR EACH ROW EXECUTE PROCEDURE track_insert_trigger();


DROP TRIGGER track_insert_trigger on track

INSERT INTO track VALUES(&#39;18860183050&#39;,116.46,39.92,&#39;2021-05-07 11:50:00&#39;,0)  /*è§¦å‘æŠ¥é”™ è¡¨ä¸å­˜åœ¨*/
</code></pre></td></tr></table>
</div>
</div><h2 id="ç´¢å¼•">ç´¢å¼•</h2>
<h3 id="å¸¸ç”¨ç´¢å¼•">å¸¸ç”¨ç´¢å¼•</h3>
<ol>
<li>Btree :ç­‰å€¼å’ŒèŒƒå›´</li>
<li>Hash ï¼šç­‰å€¼</li>
<li>GIST : å›¾å½¢æ¯”è¾ƒ</li>
<li>SP-GIST: space-partinioned Gist ï¼ˆç©ºé—´åˆ†åŒºGISTç´¢å¼•ï¼‰,ä¼˜åŒ–GISTæŸä¸ªæƒ…å†µä¸‹çš„æ€§èƒ½é—®é¢˜ï¼›</li>
<li>GIN : åè½¬ç´¢å¼•ï¼ŒåŒ…å«è¿ç®— ï¼ˆé€‚ç”¨äºjsonpã€æ•°ç»„ï¼‰</li>
</ol>
<h3 id="æ–°å»ºç´¢å¼•">æ–°å»ºç´¢å¼•</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">create /*UNIQUE8*/ index /*CONCURRENTLY*/ idx_demo_common_varchar_ 
on demo_common ( varchar_ ASC /*DESC */ NULLS FIRST /*ç©ºå€¼æ’åœ¨éç©ºå€¼å‰é¢LAST*/)
/*WITH storage_parameter = value (FILLFACTOR = 50) å¡«å……å› å­*/
/*TABLESPACE tablespace_name*/
/*WHERE predicate */

create table demo_fillfactor(id int)WITH(FILLFACTOR=50) 
/*\d+ idx_demo_common_varchar_*/



/*
1. æ•°ç»„ã€jsonb ä½¿ç”¨ @&gt;ç­‰æ¯”è¾ƒçš„ï¼Œä½¿ç”¨GINç´¢å¼•æ›´é«˜æ•ˆ;
2. å»ºç´¢å¼•æ—¶ï¼Œå¯¹è¡¨åšå…¨è¡¨æ‰«æï¼Œå¯¼è‡´åˆ›å»ºè¿‡ç¨‹CURDæ“ä½œä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç´¢å¼•åˆ›å»ºå®Œæ¯•ï¼Œé€šè¿‡CONCURRENTLYï¼Œå¯ä»¥å¹¶è¡Œå»ºç´¢å¼•ï¼ˆéœ€è¦æ—¶é—´æ›´é•¿ï¼‰;
3. é‡å»ºç´¢å¼•ä¸æ”¯æŒCONCURRENTLYï¼Œé€šè¿‡åœ¨åŒåˆ—ä¸Šé¢å»ºæ–°çš„ç´¢å¼•ï¼ˆCONCURRENTLYï¼‰ï¼Œå»ºå®Œä»¥ååˆ é™¤æ—§ç´¢å¼•;
4. fillfactorä¼šé™ä½insertçš„æ€§èƒ½,ä½†æ˜¯updateå’Œdeleteæ€§èƒ½å°†æœ‰æå‡,å¦‚æœå¡«å……ç‡ä¸º100%ï¼Œæ›´æ–°çš„æ—¶å€™ï¼Œå½“å‰æ•°æ®é¡µæ»¡ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°é¡µï¼›
*/

select * from pg_indexes where tablename=&#39;demo_common&#39;;

/*åˆ é™¤ç´¢å¼•ï¼Œé»˜è®¤RESTRICT æœ‰å¯¹è±¡ä¾èµ–è¿™ä¸ªç´¢å¼•ï¼Œåˆ é™¤ä¼šå¤±è´¥ï¼Œä½¿ç”¨  CASCADEï¼Œè”é€šä¾èµ–ä¸€èµ·åˆ é™¤ ï¼Œä¾‹å¦‚å¤–é”®çº¦æŸ */
drop index idx_demo_common_varchar_ RESTRICT 
</code></pre></td></tr></table>
</div>
</div><h2 id="é”">é”</h2>
<h3 id="acid">ACID</h3>
<ul>
<li>atomicity (åŸå­æ€§) äº‹åŠ¡è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥ï¼Œå¤±è´¥è¿›è¡Œå›æ»š</li>
<li>consisten (ä¸€è‡´æ€§) äº‹åŠ¡å®Œæˆæ—¶ï¼Œæ‰€æœ‰æ•°æ®ä¿æŒä¸€è‡´</li>
<li>isolation (éš”ç¦»æ€§) ä¸¤ä¸ªäº‹åŠ¡æŸ¥çœ‹çš„æ•°æ®å…·å¤‡éš”ç¦»ï¼Œäº’ä¸å¹²æ‰°</li>
<li>durability(æŒä¹…æ€§) æœºå™¨æ•…éšœã€æ•°æ®ä¸ä¼šä¸¢</li>
</ul>
<h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«">äº‹åŠ¡éš”ç¦»çº§åˆ«</h3>
<ol>
<li>è¯»æœªæäº¤ Read Uncommitted ï¼ˆå¯è„è¯»ã€å¯é‡å¤è¯»ã€å¹»è¯»ï¼‰</li>
<li>è¯»å·²æäº¤ Read Committed ï¼ˆå¯é‡å¤è¯»ã€å¹»è¯»ï¼‰ï¼ˆé»˜è®¤çº§åˆ«ï¼‰</li>
<li>å¯é‡å¤è¯» Repeatable Read</li>
<li>å¯ä¸²è¡ŒåŒ– Serializable ï¼ˆæœ€ä¸¥æ ¼ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">è„è¯» ï¼šäº‹åŠ¡A æ›´æ–°ä½™é¢ 1000-&gt;500  äº‹åŠ¡B å¯èƒ½åœ¨Aä¸ºæäº¤æƒ…å†µï¼Œè¯»å–åˆ°500 ï¼Œäº§ç”Ÿè„è¯»

ä¸å¯é‡å¤è¯»ï¼ˆnon-repeatable readsï¼‰ï¼šäº‹åŠ¡A æœ‰ä¸¤æ¬¡æŸ¥è¯¢ ç¬¬ä¸€æ¬¡æŸ¥ 1000ï¼Œ äº‹åŠ¡Bå¼€å§‹æ›´æ–° -500ï¼Œå¹¶æäº¤ï¼›äº‹åŠ¡Aå†ä¸€æ¬¡æŸ¥è¯¢ï¼ŒæŸ¥è¯¢åˆ°ç»“æœ500ï¼Œä¸ä¸€è‡´ï¼›

å¹»è¯»ï¼ˆphantom readï¼‰ï¼šå½“å‰äº‹åŠ¡ä¸­é‡å¤æ‰§è¡Œç›¸åŒçš„æŸ¥è¯¢,è¿”å›çš„è®°å½•æ•°å› å¦ä¸€ä¸ªäº‹ç‰©æ’å…¥æˆ–åˆ é™¤è€Œå¾—åˆ°ä¸åŒçš„ç»“æœï¼›
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">æäº¤è¦†ç›– ï¼šäº‹åŠ¡A +100 ï¼ˆ1100ï¼‰  äº‹åŠ¡B -100 ï¼ˆ900ï¼‰ï¼›æœ€ç»ˆæœ‰å¯èƒ½æ˜¯1100ï¼Œ å¾ˆå®¹æ˜“å‘ç”Ÿæ›´æ–°ä¸¢å¤±ï¼Œéœ€è¦åšå¥½å¹¶å‘å¤„ç†
</code></pre></td></tr></table>
</div>
</div><h3 id="æ­»é”">æ­»é”</h3>
<p>å‡ºç°çš„åŸå› </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">äº‹åŠ¡Aæ›´æ–°  è®°å½• Aï¼ŒB  ï¼›äº‹åŠ¡Bæ›´æ–°è®°å½• Bï¼ŒAï¼›è¿™ä¸ªæ—¶å€™Aé”å®šäº†è®°å½•A ï¼ŒBé”å®šäº†è®°å½•Bï¼Œä¸¤ä¸ªäº‹åŠ¡äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”ï¼› PostgreSQLå°†æ£€æµ‹è¿™æ ·çš„æƒ…å†µå¹¶ä¸­æ–­å…¶ä¸­ä¸€ä¸ªäº‹åŠ¡ã€‚
</code></pre></td></tr></table>
</div>
</div><p>é˜²æ­¢æ­»é”</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">é˜²æ­¢æ­»é”çš„æœ€å¥½æ–¹æ³•é€šå¸¸æ˜¯ä¿è¯æ‰€æœ‰ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“çš„åº”ç”¨éƒ½ä»¥ä¸€è‡´çš„é¡ºåºåœ¨å¤šä¸ªå¯¹è±¡ä¸Šè·å¾—é”;ä¾‹å¦‚ä¸¤ä¸ªäº‹åŠ¡æ›´æ–°é¡ºåºéƒ½æ˜¯ Aï¼ŒB
</code></pre></td></tr></table>
</div>
</div><h3 id="è¡Œçº§é”">è¡Œçº§é”</h3>
<ul>
<li>FOR KEY SHARE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">è¡Œä¸ºä¸FOR SHAREç±»ä¼¼ï¼Œä¸è¿‡é”è¾ƒå¼±ï¼šSELECT FOR UPDATEä¼šè¢«é˜»å¡ï¼›
</code></pre></td></tr></table>
</div>
</div><ul>
<li>FOR SHARE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">è¡Œä¸ºä¸FOR NO KEY UPDATEç±»ä¼¼ï¼Œä¸è¿‡å®ƒåœ¨æ¯ä¸ªæ£€ç´¢åˆ°çš„è¡Œä¸Šè·å¾—ä¸€ä¸ªå…±äº«é”è€Œä¸æ˜¯æ’ä»–é”ï¼›
ä¸€ä¸ªå…±äº«é”ä¼šé˜»å¡å…¶ä»–äº‹åŠ¡åœ¨è¿™äº›è¡Œä¸Šæ‰§è¡ŒUPDATEã€DELETEã€SELECT FOR UPDATEæˆ–è€…SELECT FOR NO KEY UPDATEï¼›
ä½†æ˜¯å®ƒä¸ä¼šé˜»æ­¢å®ƒä»¬æ‰§è¡ŒSELECT FOR SHAREæˆ–è€…SELECT FOR KEY SHARE
</code></pre></td></tr></table>
</div>
</div><ul>
<li>FOR NO KEY UPDATE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">è¡Œä¸ºä¸FOR UPDATEç±»ä¼¼ï¼Œä¸è¿‡è·å¾—çš„é”è¾ƒå¼±ï¼›å…è®¸ SELECT FOR KEY SHAREï¼›
</code></pre></td></tr></table>
</div>
</div><ul>
<li>FOR UPDATE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">å…¶ä»–å°è¯•UPDATEã€DELETEã€SELECT FOR UPDATEã€SELECT FOR NO KEY UPDATEã€SELECT FOR SHAREæˆ–è€…SELECT FOR KEY SHAREè¿™äº›è¡Œçš„äº‹åŠ¡å°†è¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰äº‹åŠ¡ç»“æŸ
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ç­‰çº§ FOR KEY SHARE &lt; FOR SHARE &lt; FOR NO KEY UPDATE &lt; FOR UPDATE</li>
</ul>
<h3 id="è¡¨çº§é”">è¡¨çº§é”</h3>
<p><a href="http://www.postgres.cn/docs/12/explicit-locking.html">å®˜æ–¹æ–‡æ¡£ã€æ³¨æ„é”å†²çª</a></p>
<ul>
<li>ACCESS EXCLUSIVE ï¼ˆé˜»å¡ä¸€ä¸ªSELECTï¼ˆä¸å¸¦FOR UPDATE/SHAREï¼‰è¯­å¥ï¼‰</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">æ“ä½œ ALTER TABLEã€DROP TABLEã€TRUNCATEã€REINDEXã€CLUSTERã€VACUUM FULLå’ŒREFRESH MATERIALIZED VIEWï¼ˆä¸å¸¦CONCURRENTLYï¼‰å‘½ä»¤è·å–
</code></pre></td></tr></table>
</div>
</div><ul>
<li>EXCLUSIVE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">æ¥è‡ªäº‹åŠ¡å‘½ä»¤ã€REFRESH MATERIALIZED VIEW CONCURRENTLYè·å¾—
</code></pre></td></tr></table>
</div>
</div><ul>
<li>Share</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ç”±CREATE INDEXï¼ˆä¸å¸¦CONCURRENTLYï¼‰å–å¾—;è¿™ç§æ¨¡å¼ä¿æŠ¤ä¸€ä¸ªè¡¨ä¸å—å¹¶å‘æ•°æ®æ”¹å˜çš„å½±å“ã€‚
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ROW EXCLUSIVE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">å‘½ä»¤UPDATEã€DELETEå’ŒINSERTåœ¨ç›®æ ‡è¡¨ä¸Šå–å¾—è¿™ç§é”æ¨¡å¼,é€šå¸¸ï¼Œè¿™ç§é”æ¨¡å¼å°†è¢«ä»»ä½•ä¿®æ”¹è¡¨ä¸­æ•°æ®çš„å‘½ä»¤å–å¾—ã€‚
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ROW SHARE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SELECT FOR UPDATEå’ŒSELECT FOR SHAREå‘½ä»¤åœ¨ç›®æ ‡è¡¨ä¸Šå–å¾—ä¸€ä¸ªè¿™ç§æ¨¡å¼çš„é” ;
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ACCESS SHARE</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SELECTå‘½ä»¤åœ¨è¢«å¼•ç”¨çš„è¡¨ä¸Šè·å¾—ä¸€ä¸ªè¿™ç§æ¨¡å¼çš„é”ã€‚é€šå¸¸ï¼Œä»»ä½•åªè¯»å–è¡¨è€Œä¸ä¿®æ”¹å®ƒçš„æŸ¥è¯¢éƒ½å°†è·å¾—è¿™ç§é”æ¨¡å¼ã€‚
</code></pre></td></tr></table>
</div>
</div><h3 id="äºŒé˜¶æ®µæäº¤">äºŒé˜¶æ®µæäº¤</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*äºŒé˜¶æ®µæäº¤*/
/*1. ä¿®æ”¹é…ç½® postgresql.conf max_prepared_transactions =10 */
/*
begin;
insert into demo_common values(1);
prepare transaction &#39;osdba_global_trans_0001&#39;; //åˆ†é…å…¨å±€äº‹åŠ¡ID ,ç”±äº‹åŠ¡åè°ƒå™¨å®ç°
COMMIT prepared &#39;osdba_global_trans_0001&#39;;
*/
</code></pre></td></tr></table>
</div>
</div><h2 id="å†…å¹•">å†…å¹•</h2>
<h3 id="æ‰§è¡Œè®¡åˆ’">æ‰§è¡Œè®¡åˆ’</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*æ‰§è¡Œè®¡åˆ’
1. å› ä¸ºæ•°æ®é›†å¤ªå°è€Œéœ€è¦å¿«é€Ÿç¡®è®¤æŸ¥è¯¢æ˜¯å¦æœ‰ä½¿ç”¨ç´¢å¼• set enable_seqscan=false ï¼ˆå»ºäº†ç´¢å¼•ä¸ä¸€å®šä¼šèµ°ç´¢å¼•ï¼ŒæŸ¥è¯¢ä¼˜åŒ–å™¨ä¼šæ ¹æ®å®é™…æƒ…å†µè¯„ä¼°ï¼‰
2. ç´¢å¼•ç±»å‹
	- seq scan (å…¨è¡¨æ‰«æ)
	- index scan(ç´¢å¼•æ‰«æ)
	- bitmap index scan(ä½å›¾æ‰«æ)
3. æ¡ä»¶è¿‡æ»¤
	- Filter
	- å¦‚æœæ¡ä»¶çš„åˆ—ä¸Šæœ‰ç´¢å¼•ï¼Œå¯èƒ½ä¼šèµ°ç´¢å¼•ï¼Œä¸èµ°è¿‡æ»¤
4. Nestloop Join (åµŒå¥—å¾ªç¯è¿æ¥)
	- é©±åŠ¨è¡¨å°ï¼ˆ&lt;10000ï¼‰,innerè¡¨æœ‰æœ‰æ•ˆçš„ï¼ˆIndexï¼‰ï¼Œè¿™æ ·å“åº”æœ€å¿«
5. Hash Join (æ•£åˆ—è¿æ¥)
	- ä½¿ç”¨è¾ƒå°çš„è¡¨ å»ºç«‹æ•£åˆ—è¡¨ï¼Œå†æ‰«æè¾ƒå¤§çš„è¡¨ ï¼ˆfrom a,b where a.id = b.idï¼‰
	- ä¸¤è¡¨ï¼ˆå°½ç„¶å°ï¼‰å¯ä»¥æ”¾åœ¨å†…å­˜ï¼Œå¦åˆ™éœ€è¦éƒ¨åˆ†å†™åˆ°ç£ç›˜ï¼Œæ€»æˆæœ¬= è®¿é—®ä¸¤è¡¨çš„æˆæœ¬å’Œ
6. Merge Join  (åˆå¹¶è¿æ¥)
	- é€šå¸¸æ€§èƒ½ æ•£åˆ—è¿æ¥ &gt; åˆå¹¶è¿æ¥ï¼Œå¦‚æœä¸¤è¡¨éƒ½æœ‰ç´¢å¼•ï¼Œä¸”ç´¢å¼•æ‰«æçš„åˆ—å·²ç»æ’åºï¼Œæ­¤æ—¶åˆå¹¶è¿æ¥æ›´å¥½
*/
set enable_seqscan=false
EXPLAIN /*(format json)*/ SELECT * from track where simnum=&#39;18860183050&#39; and track_time &gt;&#39;2021-04-30&#39; and track_time &lt;&#39;2021-05-5&#39;
EXPLAIN  ANALYZE VERBOSE  SELECT * from track where track_time &gt;&#39;2021-05-1&#39; and track_time &lt;&#39;2021-05-2&#39;
EXPLAIN  ANALYZE VERBOSE  SELECT * from track_20210501 where track_time &gt;&#39;2021-04-30&#39; and track_time &lt;&#39;2021-05-1&#39; and simnum=&#39;18860183050&#39;

/*æŸ¥çœ‹è¡¨å¤§å°ï¼Œå…³è”çš„æ—¶å€™ ï¼Œå°è¡¨é©±åŠ¨å¤§è¡¨*/
select pg_relation_size(&#39;track_20210501&#39;)
</code></pre></td></tr></table>
</div>
</div><h3 id="ç»Ÿè®¡ä¿¡æ¯">ç»Ÿè®¡ä¿¡æ¯</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*æ‰‹å·¥æ‰‹æœºç»Ÿè®¡ä¿¡æ¯
- ANALYZE [VERBOSE] table (column)
æ‰‹åŠ¨æ‰‹æœºè¡¨çš„ ç»Ÿè®¡ä¿¡æ¯åˆ° pg_statistic ï¼Œä¼˜åŒ–å™¨ä½¿ç”¨è¿™äº›ç»Ÿè®¡ä¿¡æ¯æ¥ç¡®å®šæœ€å‹çš„æ‰§è¡Œè®¡åˆ’
*/
ANALYZE track_20210501
select * from pg_statistic
select * from pg_stat_activity
</code></pre></td></tr></table>
</div>
</div><h3 id="åºå·">åºå·</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">/*åºå·*/
create SEQUENCE seqtest ;
select nextval(&#39;seqtest&#39;);
select currval(&#39;seqtest&#39;);
select setval(&#39;seqtest&#39;,1,FALSE)
</code></pre></td></tr></table>
</div>
</div><h3 id="æœåŠ¡ç®¡ç†">æœåŠ¡ç®¡ç†</h3>
<ul>
<li>æœåŠ¡å¯åœ</li>
</ul>
<p>pg_ctl stop/start -D /home/user/data -m smart/fast(å¸¸ç”¨)/immediate</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">smart ä¸å…è®¸æ–°è¿æ¥ï¼Œç­‰å¾…è¿æ¥ä¸»åŠ¨å…³é—­ä»¥åï¼ŒæœåŠ¡æ‰ä¼šåœæ­¢
fast   ä¸å…è®¸æ–°è¿æ¥ï¼Œå¼ºåˆ¶ç«‹å³å…³é—­ï¼ŒæœåŠ¡æ‰ä¼šåœæ­¢
immediate ç«‹å³å…³é—­ï¼Œå­è¿›ç¨‹ç«‹å³é€€å‡ºï¼Œä¸‹æ¬¡å¯åŠ¨æ•°æ®åº“å›æ”¾ WALæ—¥å¿—ï¼ˆç´§æ€¥æ—¶ä½¿ç”¨ï¼‰
</code></pre></td></tr></table>
</div>
</div><ul>
<li>åŠ è½½é…ç½®</li>
</ul>
<p>pg_ctl reload -D /home/user/data</p>
<ul>
<li>åœæ­¢æŸ¥è¯¢</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">SessionA æ‰§è¡ŒæŸ¥è¯¢
select pg_sleep(600);

SessionB å…³é—­æŸ¥è¯¢
select pg_backend_pid();
select pg_cancel_backend(11380);
æˆ–è€…
.\pg_ctl.exe kill INT 11380
</code></pre></td></tr></table>
</div>
</div><ul>
<li>ç™»å½•ä¿®æ”¹</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">6.é…ç½®è¿è¡Œè¿œç¨‹å±€åŸŸç½‘è¿æ¥
ä¿®æ”¹postgresql.conf  
listen_addresses = &#39;*&#39;

ä¿®æ”¹pg_hba.conf   
# TYPE  DATABASE  USER  CIDR-ADDRESS  METHOD
host    all       all   0.0.0.0/0     md5ï¼ˆpasswordã€trustï¼‰
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>å¤‡ä»½è¿˜åŸ</p>
<ul>
<li>å¤‡ä»½ pg_dump  &ndash;help(è¯¦ç»†æŸ¥çœ‹)</li>
<li>è¿˜åŸ pg_restore</li>
</ul>
</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">tipğŸŒ³tok( â€¢Ì€ Ï‰ â€¢Ì )y</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2021-06-21
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        
        
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://twitter.com/of_yangf" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/tiptok" class="iconfont icon-github" title="github"></a>
  <a href="https://tiptok.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2020 - 
    2021<span class="heart"><i class="iconfont icon-heart"></i></span><span>tipğŸŒ³tok( â€¢Ì€ Ï‰ â€¢Ì )y</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.c12618f9a600c40bd024996677e951e64d3487006775aeb22e200c990006c5c7.js"></script>








</body>
</html>
